<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>אליפות הסולפג' – הימורים (לא על אמת, כן?)</title>
  <style>
    body { font-family: system-ui, Arial; margin: 16px; line-height: 1.35; }
    .card { border: 1px solid #ddd; border-radius: 16px; padding: 14px; margin: 12px 0; }
    h1 { font-size: 20px; margin: 0 0 10px; }
    h2 { font-size: 16px; margin: 0 0 10px; }
    label { display: block; margin: 10px 0 6px; }
    select, input { width: 100%; padding: 10px; border-radius: 12px; border: 1px solid #ccc; background: white; }
    button { padding: 12px 14px; border-radius: 14px; border: 1px solid #111; background: #111; color: #fff; width: 100%; font-size: 16px; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .muted { color: #666; font-size: 13px; }
    .ok { color: #0a7; }
    .err { color: #c33; }
    #errBanner { display:none; border:1px solid #c33; color:#c33; border-radius:14px; padding:10px; margin-bottom:12px; }
  </style>
</head>
<body>

<div id="errBanner"></div>

<h1>אליפות הסולפג' – טופס הימורים</h1>
<div class="muted">ממלאים בתים → רבעים → חצאים → גמר → שולחים.</div>

<div class="card">
  <h2>פרטים</h2>
  <label>שם התלמיד/ה</label>
  <input id="studentName" placeholder="למשל: אמה" />
</div>

<div class="card">
  <h2>שלב הבתים</h2>
  <div id="groups"></div>
  <div class="muted">בכל בית לבחור מקום 1 ומקום 2 (לא אותו שם פעמיים).</div>
</div>

<div class="card">
  <h2>רבע גמר</h2>
  <div id="quarters"></div>
</div>

<div class="card">
  <h2>חצי גמר</h2>
  <div id="semis"></div>
</div>

<div class="card">
  <h2>גמר + אלוף</h2>
  <div id="finals"></div>
</div>

<div class="card">
  <button id="submitBtn">שלח הימורים</button>
  <div id="status" class="muted" style="margin-top:10px;"></div>
</div>

<script>
/* ====== DEBUG ====== */
window.onerror = function(msg, src, line) {
  const b = document.getElementById("errBanner");
  b.style.display = "block";
  b.textContent = `שגיאת JavaScript: ${msg} (שורה ${line})`;
};

/* ====== SCRIPT URL ====== */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw8xXqcsan6fDdlTWFbIyQ8SLt738BL6CHBoW_ub2N8IKYGdQdbFE7ODerqPRQC8t0l/exec";

/* ====== DATA ====== */
const HOUSES = {
  "בית א׳": ["אורי גולן","סתיו","יהונתן","אביתר"],
  "בית ב׳": ["אמה","דריה","אורי לנקרי","איתמר"],
  "בית ג׳": ["עופר","אביב","איתי","יהלי"],
  "בית ד׳": ["אמילי","אריאל","לינוי"]
};

const QUARTERS = [
  {id:"QF1", a:["בית א׳",1], b:["בית ג׳",2]},
  {id:"QF2", a:["בית א׳",2], b:["בית ג׳",1]},
  {id:"QF3", a:["בית ב׳",1], b:["בית ד׳",2]},
  {id:"QF4", a:["בית ד׳",1], b:["בית ב׳",2]}
];

const state = { groups:{}, quarters:{}, semis:{}, finals:{} };

/* ====== HELPERS ====== */
const el = (t,c={},ch=[]) => {
  const e=document.createElement(t);
  Object.entries(c).forEach(([k,v])=>k==="class"?e.className=v:e.setAttribute(k,v));
  (Array.isArray(ch)?ch:[ch]).forEach(x=>e.appendChild(typeof x==="string"?document.createTextNode(x):x));
  return e;
};

const select = (opts,ph) => {
  const s=el("select");
  s.appendChild(el("option",{value:""},ph));
  opts.forEach(o=>s.appendChild(el("option",{value:o},o)));
  return s;
};

/* ====== RENDER ====== */
function renderGroups(){
  const root=document.getElementById("groups");
  root.innerHTML="";
  Object.keys(HOUSES).forEach(h=>{
    const c=el("div",{class:"card"});
    c.appendChild(el("h2",{},h));
    const r=el("div",{class:"row"});
    const s1=select(HOUSES[h],"מקום 1");
    const s2=select(HOUSES[h],"מקום 2");

    s1.onchange=()=>{state.groups[h]=state.groups[h]||{};state.groups[h][1]=s1.value;renderAll();};
    s2.onchange=()=>{state.groups[h]=state.groups[h]||{};state.groups[h][2]=s2.value;renderAll();};

    r.appendChild(el("div",{},[el("label",{},"מקום 1"),s1]));
    r.appendChild(el("div",{},[el("label",{},"מקום 2"),s2]));
    c.appendChild(r); root.appendChild(c);
  });
}

function pos(h,p){return state.groups[h]?.[p]||"";}

function renderQuarters(){
  const r=document.getElementById("quarters"); r.innerHTML="";
  QUARTERS.forEach(q=>{
    const a=pos(...q.a), b=pos(...q.b);
    const opts=[a,b].filter(Boolean);
    const c=el("div",{class:"card"});
    c.appendChild(el("h2",{},`${a||"?"} מול ${b||"?"}`));
    const s=select(opts,"בחר מנצח");
    s.disabled=opts.length!==2;
    s.onchange=()=>{state.quarters[q.id]=s.value;renderSemis();};
    c.appendChild(s); r.appendChild(c);
  });
}

function renderSemis(){
  const r=document.getElementById("semis"); r.innerHTML="";
  const s1=[state.quarters.QF1,state.quarters.QF2].filter(Boolean);
  const s2=[state.quarters.QF3,state.quarters.QF4].filter(Boolean);

  [s1,s2].forEach((arr,i)=>{
    const c=el("div",{class:"card"});
    c.appendChild(el("h2",{},`חצי גמר ${i+1}`));
    const s=select(arr,"בחר מנצח");
    s.disabled=arr.length!==2;
    s.onchange=()=>{state.semis["SF"+(i+1)]=s.value;renderFinals();};
    c.appendChild(s); r.appendChild(c);
  });
}

function renderFinals(){
  const r=document.getElementById("finals"); r.innerHTML="";
  const f=[state.semis.SF1,state.semis.SF2].filter(Boolean);
  const c=el("div",{class:"card"});
  c.appendChild(el("h2",{},`גמר: ${f[0]||"?"} מול ${f[1]||"?"}`));
  const s=select(f,"בחר אלוף");
  s.disabled=f.length!==2;
  s.onchange=()=>state.finals.CHAMP=s.value;
  c.appendChild(s); r.appendChild(c);
}

function renderAll(){ renderQuarters(); renderSemis(); renderFinals(); }

/* ====== SUBMIT ====== */
async function submit(){
  const status=document.getElementById("status");
  const name=document.getElementById("studentName").value.trim();
  if(!name){status.textContent="חסר שם.";status.className="err";return;}

  try{
    status.textContent="שולח…"; status.className="muted";
    await fetch(SCRIPT_URL,{method:"POST",mode:"no-cors",body:JSON.stringify({studentName:name,...state})});
    status.textContent="נשלח ✅ (בדוק בשיטס)"; status.className="ok";
  }catch(e){
    status.textContent="שליחה נכשלה."; status.className="err";
  }
}

document.getElementById("submitBtn").onclick=submit;

renderGroups(); renderAll();
</script>
</body>
</html>



